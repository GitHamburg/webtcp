function Http(j){this.cID=Math.random().toString(36).substr(2);this.webtcp=j;this.webtcp.httpClients[this.cID]=this;this.createPacket=function(){return{cID:this.cID,type:"http",host:this.remoteAddress,port:this.remotePort,method:null,data:null}};this.ondata=function(){};this.get=function(e,b){this.on("data",b);this.rpc("httpGet",[e])};this.post=function(e,b,j){this.on("data",j);this.rpc("httpPost",[e,b])}}Http.prototype=new WebTCPAPI;function Redis(j,e,b,k){this.webtcp=j;this.conn=net.createSocket(e,b,k);this.callbacks=[];var g=this;this.conn.on("data",function(b){b=g.parseReply(b);g.ondataCustom(b)});this.to_redis_proto=function(b){args=b.split(/ +/);str="*"+args.length+"\r\n";for(i=0;i<args.length;i++)b=args[i],str+="$"+b.length+"\r\n"+b+"\r\n";return str};this.parseReply=function(b){var e=b.charAt(0),b=b.substr(1).split("\r\n");result=[];for(var j in b)("$"==e||"*"==e)&&0==j||""!=b[j]&&("$"!=b[j].charAt(0)&&"*"!=b[j].charAt(0))&&
result.push(b[j]);1==result.length&&(result=result[0]);return result};this.conn.on("data",function(b){var b=g.parseReply(b),e;for(e in b)0<g.callbacks.length&&(callback=g.callbacks.shift(),callback(b[e]))});this.send=function(b,e){data=this.to_redis_proto(b);this.callbacks.push(e);packetId=this.conn.write(data)};this.on=function(b,e){this["on"+b+"Custom"]=e}}function ReplyParser(j,e){this.onReply=j;this.thisArg=e;this.clearState();this.clearMultiBulkState()}
ReplyParser.prototype.clearState=function(){this.type=NONE;this.bulkLengthExpected=null;this.skip=this.valueBufferLen=0;this.valueBuffer=new Buffer(4096)};ReplyParser.prototype.clearMultiBulkState=function(){this.multibulkRepliesExpected=this.multibulkReplies=null};
ReplyParser.prototype.feed=function(j){for(var e=0;e<j.length;++e)if(0<this.skip)this.skip--;else{var b=this.type;if(this.type===NONE)switch(j[e]){case DOLLAR:this.type=BULK;break;case STAR:this.type=MULTIBULK;break;case COLON:this.type=INTEGER;break;case PLUS:this.type=INLINE;break;case MINUS:this.type=ERROR}if(b==this.type){var k=this,b=function(b){null!=k.multibulkReplies?(k.multibulkReplies.push(b),0==--k.multibulkRepliesExpected&&(k.onReply.call(k.thisArg,{type:MULTIBULK,value:k.multibulkReplies}),
k.clearMultiBulkState())):k.onReply.call(k.thisArg,b);k.clearState();k.skip=1};switch(j[e]){case CR:switch(this.type){case INLINE:case ERROR:var g=new Buffer(this.valueBufferLen);this.valueBuffer.copy(g,0,0,this.valueBufferLen);b({type:this.type,value:g});break;case INTEGER:g=parseInt(this.valueBuffer.asciiSlice(0,this.valueBufferLen),10);b({type:INTEGER,value:g});break;case BULK:null==this.bulkLengthExpected?(g=parseInt(this.valueBuffer.asciiSlice(0,this.valueBufferLen),10),0>=g?b({type:BULK,value:null}):
(this.clearState(),this.bulkLengthExpected=g,this.type=BULK,this.skip=1)):this.valueBufferLen==this.bulkLengthExpected?(g=new Buffer(this.valueBufferLen),this.valueBuffer.copy(g,0,0,this.valueBufferLen),b({type:BULK,value:g})):this.valueBuffer[this.valueBufferLen++]=j[e];break;case MULTIBULK:g=parseInt(this.valueBuffer.asciiSlice(0,this.valueBufferLen),10),0>=g?b({type:MULTIBULK,value:null}):(this.clearState(),this.skip=1,this.multibulkReplies=[],this.multibulkRepliesExpected=g)}break;default:this.valueBuffer[this.valueBufferLen++]=
j[e]}this.valueBufferLen===this.valueBuffer.length&&(b=new Buffer(2*this.valueBuffer.length),this.valueBuffer.copy(b,0,0),this.valueBuffer=b)}}};function Socket(j,e,b,k){this.sID=Math.random().toString(36).substr(2);this.webtcp=j;this.closed=this.ready=!1;this.options=k;this.sockOpts={_updating:!1};this.remoteAddress=e;this.remotePort=b;this.webtcp.sockets[this.sID]=this;this.createPacket=function(){return{id:Math.random().toString(36).substr(2),sID:this.sID,type:"tcp",options:this.options,host:this.remoteAddress,port:this.remotePort,data:null}};this.onconnect=function(){this.webtcp.sockets[sID].ready=!0;this.webtcp.sockets[sID].closed=!1};
this.ondata=function(){};this.onend=function(){};this.ontimeout=function(){};this.ondrain=function(){};this.onclose=function(){this.webtcp.sockets[sID].ready=!1;this.webtcp.sockets[sID].closed=!0};this.getSockOpts=function(){this.sockOpts._updating=!0;this.rpc("getSockOpts")};this.onSockOptsRcv=function(b){this.sockOpts=b;this.sockOpts._updating=!1}}Socket.prototype=new WebTCPAPI;var JSON;JSON||(JSON={});
(function(){function j(b,k){var g,s,t,x,l=n,h,m=k[b];m&&"object"==typeof m&&"function"==typeof m.toJSON&&(m=m.toJSON(b));"function"==typeof q&&(m=q.call(k,b,m));switch(typeof m){case "string":return e(m);case "number":return isFinite(m)?String(m):"null";case "boolean":case "null":return String(m);case "object":if(!m)return"null";n+=v;h=[];if("[object Array]"===Object.prototype.toString.apply(m)){x=m.length;for(g=0;g<x;g+=1)h[g]=j(g,m)||"null";t=0===h.length?"[]":n?"[\n"+n+h.join(",\n"+n)+"\n"+l+"]":
"["+h.join(",")+"]";n=l;return t}if(q&&"object"==typeof q){x=q.length;for(g=0;g<x;g+=1)"string"==typeof q[g]&&(s=q[g],t=j(s,m),t&&h.push(e(s)+(n?": ":":")+t))}else for(s in m)Object.prototype.hasOwnProperty.call(m,s)&&(t=j(s,m),t&&h.push(e(s)+(n?": ":":")+t));t=0===h.length?"{}":n?"{\n"+n+h.join(",\n"+n)+"\n"+l+"}":"{"+h.join(",")+"}";n=l;return t}}function e(b){g.lastIndex=0;return g.test(b)?'"'+b.replace(g,function(b){var e=B[b];return"string"==typeof e?e:"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)})+
'"':'"'+b+'"'}function b(b){return 10>b?"0"+b:b}"use strict";"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+b(this.getUTCMonth()+1)+"-"+b(this.getUTCDate())+"T"+b(this.getUTCHours())+":"+b(this.getUTCMinutes())+":"+b(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var k=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
g=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n,v,B={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},q;"function"!=typeof JSON.stringify&&(JSON.stringify=function(b,e,g){var k;v=n="";if("number"==typeof g)for(k=0;k<g;k+=1)v+=" ";else"string"==typeof g&&(v=g);q=e;if(!e||"function"==typeof e||"object"==typeof e&&"number"==typeof e.length)return j("",{"":b});throw Error("JSON.stringify");});"function"!=
typeof JSON.parse&&(JSON.parse=function(b,e){function j(b,g){var k,h,m=b[g];if(m&&"object"==typeof m)for(k in m)Object.prototype.hasOwnProperty.call(m,k)&&(h=j(m,k),void 0!==h?m[k]=h:delete m[k]);return e.call(b,g,m)}var g,b=String(b);k.lastIndex=0;k.test(b)&&(b=b.replace(k,function(b){return"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(b.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return g=eval("("+b+")"),"function"==typeof e?j({"":g},""):g;throw new SyntaxError("JSON.parse");})})();
SockJS=function(){var j=document,e=window,b={},k=function(){};k.prototype.addEventListener=function(a,c){this._listeners||(this._listeners={});a in this._listeners||(this._listeners[a]=[]);var d=this._listeners[a];-1===b.arrIndexOf(d,c)&&d.push(c)};k.prototype.removeEventListener=function(a,c){if(this._listeners&&a in this._listeners){var d=this._listeners[a],f=b.arrIndexOf(d,c);-1!==f&&(1<d.length?this._listeners[a]=d.slice(0,f).concat(d.slice(f+1)):delete this._listeners[a])}};k.prototype.dispatchEvent=
function(a){var c=a.type,b=Array.prototype.slice.call(arguments,0);this["on"+c]&&this["on"+c].apply(this,b);if(this._listeners&&c in this._listeners)for(var f=0;f<this._listeners[c].length;f++)this._listeners[c][f].apply(this,b)};var g=function(a,c){this.type=a;if("undefined"!=typeof c)for(var b in c)c.hasOwnProperty(b)&&(this[b]=c[b])};g.prototype.toString=function(){var a=[],c;for(c in this)if(this.hasOwnProperty(c)){var b=this[c];"function"==typeof b&&(b="[function]");a.push(c+"="+b)}return"SimpleEvent("+
a.join(", ")+")"};var n=function(a){this.events=a||[]};n.prototype.emit=function(a){var c=Array.prototype.slice.call(arguments,1);!this.nuked&&this["on"+a]&&this["on"+a].apply(this,c);-1===b.arrIndexOf(this.events,a)&&b.log("Event "+JSON.stringify(a)+" not listed "+JSON.stringify(this.events)+" in "+this)};n.prototype.nuke=function(){this.nuked=!0;for(var a=0;a<this.events.length;a++)delete this[this.events[a]]};b.random_string=function(a,c){var c=c||37,b,f=[];for(b=0;b<a;b++)f.push("abcdefghijklmnopqrstuvwxyz0123456789_".substr(Math.floor(Math.random()*
c),1));return f.join("")};b.random_number=function(a){return Math.floor(Math.random()*a)};b.random_number_string=function(a){var c=(""+(a-1)).length;return(Array(c+1).join("0")+b.random_number(a)).slice(-c)};b.getOrigin=function(a){return(a+"/").split("/").slice(0,3).join("/")};b.isSameOriginUrl=function(a,c){return c||(c=e.location.href),a.split("/").slice(0,3).join("/")===c.split("/").slice(0,3).join("/")};b.getParentDomain=function(a){return/^[0-9.]*$/.test(a)||/^\[/.test(a)||!/[.]/.test(a)?a:
a.split(".").slice(1).join(".")};b.objectExtend=function(a,c){for(var b in c)c.hasOwnProperty(b)&&(a[b]=c[b]);return a};b.polluteGlobalNamespace=function(){"_jp"in e||(e._jp={})};b.closeFrame=function(a,c){return"c"+JSON.stringify([a,c])};b.userSetCode=function(a){return 1E3===a||3E3<=a&&4999>=a};b.countRTO=function(a){var c;return 100<a?c=3*a:c=a+200,c};b.log=function(){e.console&&console.log&&console.log.apply&&console.log.apply(console,arguments)};b.bind=function(a,c){return a.bind?a.bind(c):function(){return a.apply(c,
arguments)}};b.flatUrl=function(a){return-1===a.indexOf("?")&&-1===a.indexOf("#")};b.amendUrl=function(a){var c=j.location;if(!a)throw Error("Wrong url for SockJS");if(!b.flatUrl(a))throw Error("Only basic urls are supported in SockJS");return 0===a.indexOf("//")&&(a=c.protocol+a),0===a.indexOf("/")&&(a=c.protocol+"//"+c.host+a),a=a.replace(/[/]+$/,""),a};b.arrIndexOf=function(a,c){for(var b=0;b<a.length;b++)if(a[b]===c)return b;return-1};b.arrSkip=function(a,c){var d=b.arrIndexOf(a,c);return-1===
d?a.slice():a.slice(0,d).concat(a.slice(d+1))};b.isArray=Array.isArray||function(a){return 0<={}.toString.call(a).indexOf("Array")};b.delay=function(a,c){return"function"==typeof a&&(c=a,a=0),setTimeout(c,a)};var v=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,B={"\x00":"\\u0000","\u0001":"\\u0001","\u0002":"\\u0002","\u0003":"\\u0003","\u0004":"\\u0004","\u0005":"\\u0005","\u0006":"\\u0006","\u0007":"\\u0007","\b":"\\b",
"\t":"\\t","\n":"\\n","\x0B":"\\u000b","\f":"\\f","\r":"\\r","\u000e":"\\u000e","\u000f":"\\u000f","\u0010":"\\u0010","\u0011":"\\u0011","\u0012":"\\u0012","\u0013":"\\u0013","\u0014":"\\u0014","\u0015":"\\u0015","\u0016":"\\u0016","\u0017":"\\u0017","\u0018":"\\u0018","\u0019":"\\u0019","\u001a":"\\u001a","\u001b":"\\u001b","\u001c":"\\u001c","\u001d":"\\u001d","\u001e":"\\u001e","\u001f":"\\u001f",'"':'\\"',"\\":"\\\\","\u007f":"\\u007f","\u0080":"\\u0080","\u0081":"\\u0081","\u0082":"\\u0082",
"\u0083":"\\u0083","\u0084":"\\u0084","\u0085":"\\u0085","\u0086":"\\u0086","\u0087":"\\u0087","\u0088":"\\u0088","\u0089":"\\u0089","\u008a":"\\u008a","\u008b":"\\u008b","\u008c":"\\u008c","\u008d":"\\u008d","\u008e":"\\u008e","\u008f":"\\u008f","\u0090":"\\u0090","\u0091":"\\u0091","\u0092":"\\u0092","\u0093":"\\u0093","\u0094":"\\u0094","\u0095":"\\u0095","\u0096":"\\u0096","\u0097":"\\u0097","\u0098":"\\u0098","\u0099":"\\u0099","\u009a":"\\u009a","\u009b":"\\u009b","\u009c":"\\u009c","\u009d":"\\u009d",
"\u009e":"\\u009e","\u009f":"\\u009f","\u00ad":"\\u00ad","\u0600":"\\u0600","\u0601":"\\u0601","\u0602":"\\u0602","\u0603":"\\u0603","\u0604":"\\u0604","\u070f":"\\u070f","\u17b4":"\\u17b4","\u17b5":"\\u17b5","\u200c":"\\u200c","\u200d":"\\u200d","\u200e":"\\u200e","\u200f":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","\u202a":"\\u202a","\u202b":"\\u202b","\u202c":"\\u202c","\u202d":"\\u202d","\u202e":"\\u202e","\u202f":"\\u202f","\u2060":"\\u2060","\u2061":"\\u2061","\u2062":"\\u2062","\u2063":"\\u2063",
"\u2064":"\\u2064","\u2065":"\\u2065","\u2066":"\\u2066","\u2067":"\\u2067","\u2068":"\\u2068","\u2069":"\\u2069","\u206a":"\\u206a","\u206b":"\\u206b","\u206c":"\\u206c","\u206d":"\\u206d","\u206e":"\\u206e","\u206f":"\\u206f","\ufeff":"\\ufeff","\ufff0":"\\ufff0","\ufff1":"\\ufff1","\ufff2":"\\ufff2","\ufff3":"\\ufff3","\ufff4":"\\ufff4","\ufff5":"\\ufff5","\ufff6":"\\ufff6","\ufff7":"\\ufff7","\ufff8":"\\ufff8","\ufff9":"\\ufff9","\ufffa":"\\ufffa","\ufffb":"\\ufffb","\ufffc":"\\ufffc","\ufffd":"\\ufffd",
"\ufffe":"\\ufffe","\uffff":"\\uffff"},q=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,
C,M=JSON&&JSON.stringify||function(a){return v.lastIndex=0,v.test(a)&&(a=a.replace(v,function(a){return B[a]})),'"'+a+'"'};b.quote=function(a){a=M(a);q.lastIndex=0;if(q.test(a)){if(!C){var b,d={},f=[];for(b=0;65536>b;b++)f.push(String.fromCharCode(b));C=(q.lastIndex=0,f.join("").replace(q,function(a){return d[a]="\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4),""}),q.lastIndex=0,d)}a=a.replace(q,function(a){return C[a]})}return a};var D="websocket xdr-streaming xhr-streaming iframe-eventsource iframe-htmlfile xdr-polling xhr-polling iframe-xhr-polling jsonp-polling".split(" ");
b.probeProtocols=function(){for(var a={},b=0;b<D.length;b++){var d=D[b];a[d]=h[d]&&h[d].enabled()}return a};b.detectProtocols=function(a,b,d){var f={},p=[];b||(b=D);for(var e=0;e<b.length;e++){var h=b[e];f[h]=a[h]}var j=function(a){var b=a.shift();f[b]?p.push(b):0<a.length&&j(a)};return!1!==d.websocket&&j(["websocket"]),f["xhr-streaming"]&&!d.null_origin?p.push("xhr-streaming"):f["xdr-streaming"]&&!d.cookie_needed&&!d.null_origin?p.push("xdr-streaming"):j(["iframe-eventsource","iframe-htmlfile"]),
f["xhr-polling"]&&!d.null_origin?p.push("xhr-polling"):f["xdr-polling"]&&!d.cookie_needed&&!d.null_origin?p.push("xdr-polling"):j(["iframe-xhr-polling","jsonp-polling"]),p};b.createHook=function(){var a="a"+b.random_string(8);if(!("_sockjs_global"in e)){var c={};e._sockjs_global=function(a){return a in c||(c[a]={id:a,del:function(){delete c[a]}}),c[a]}}return e._sockjs_global(a)};b.attachMessage=function(a){b.attachEvent("message",a)};b.attachEvent=function(a,b){"undefined"!=typeof e.addEventListener?
e.addEventListener(a,b,!1):(j.attachEvent("on"+a,b),e.attachEvent("on"+a,b))};b.detachMessage=function(a){b.detachEvent("message",a)};b.detachEvent=function(a,b){"undefined"!=typeof e.addEventListener?e.removeEventListener(a,b,!1):(j.detachEvent("on"+a,b),e.detachEvent("on"+a,b))};var s={},t=!1,x=function(){for(var a in s)s[a](),delete s[a]},l=function(){t||(t=!0,x())};b.attachEvent("beforeunload",l);b.attachEvent("unload",l);b.unload_add=function(a){var c=b.random_string(8);return s[c]=a,t&&b.delay(x),
c};b.unload_del=function(a){a in s&&delete s[a]};b.createIframe=function(a,c){var d=j.createElement("iframe"),f,p,e=function(){clearTimeout(f);try{d.onload=null}catch(a){}d.onerror=null},h=function(){d&&(e(),setTimeout(function(){d&&d.parentNode.removeChild(d);d=null},0),b.unload_del(p))};return d.src=a,d.style.display="none",d.style.position="absolute",d.onerror=function(){d&&(h(),c("onerror"))},d.onload=function(){clearTimeout(f);f=setTimeout(function(){d&&(h(),c("onload timeout"))},2E3)},j.body.appendChild(d),
f=setTimeout(function(){d&&(h(),c("timeout"))},15E3),p=b.unload_add(h),{post:function(a,b){try{d&&d.contentWindow&&d.contentWindow.postMessage(a,b)}catch(c){}},cleanup:h,loaded:e}};b.createHtmlfile=function(a,c){var d=new ActiveXObject("htmlfile"),f,p,h,j=function(){clearTimeout(f)},g=function(){d&&(j(),b.unload_del(p),h.parentNode.removeChild(h),h=d=null,CollectGarbage())};d.open();d.write('<html><script>document.domain="'+document.domain+'";<\/script></html>');d.close();d.parentWindow._jp=e._jp;
var k=d.createElement("div");return d.body.appendChild(k),h=d.createElement("iframe"),k.appendChild(h),h.src=a,f=setTimeout(function(){d&&(g(),c("timeout"))},15E3),p=b.unload_add(g),{post:function(a,b){try{h&&h.contentWindow&&h.contentWindow.postMessage(a,b)}catch(c){}},cleanup:g,loaded:j}};l=function(){};l.prototype=new n(["chunk","finish"]);l.prototype._start=function(a,c,d,f){var p=this;try{p.xhr=new XMLHttpRequest}catch(h){}if(!p.xhr)try{p.xhr=new e.ActiveXObject("Microsoft.XMLHTTP")}catch(j){}if(e.ActiveXObject||
e.XDomainRequest)c+=(-1===c.indexOf("?")?"?":"&")+"t="+ +new Date;p.unload_ref=b.unload_add(function(){p._cleanup(!0)});try{p.xhr.open(a,c,!0)}catch(g){p.emit("finish",0,"");p._cleanup();return}if(!f||!f.no_credentials)p.xhr.withCredentials="true";if(f&&f.headers)for(var k in f.headers)p.xhr.setRequestHeader(k,f.headers[k]);p.xhr.onreadystatechange=function(){if(p.xhr){var a=p.xhr;switch(a.readyState){case 3:try{var b=a.status,c=a.responseText}catch(f){}c&&0<c.length&&p.emit("chunk",b,c);break;case 4:p.emit("finish",
a.status,a.responseText),p._cleanup(!1)}}};p.xhr.send(d)};l.prototype._cleanup=function(a){if(this.xhr){b.unload_del(this.unload_ref);this.xhr.onreadystatechange=function(){};if(a)try{this.xhr.abort()}catch(c){}this.unload_ref=this.xhr=null}};l.prototype.close=function(){this.nuke();this._cleanup(!0)};(b.XHRCorsObject=function(){var a=this,c=arguments;b.delay(function(){a._start.apply(a,c)})}).prototype=new l;(b.XHRLocalObject=function(a,c,d){var f=this;b.delay(function(){f._start(a,c,d,{no_credentials:!0})})}).prototype=
new l;l=b.XDRObject=function(a,c,d){var f=this;b.delay(function(){f._start(a,c,d)})};l.prototype=new n(["chunk","finish"]);l.prototype._start=function(a,c,d){var f=this,p=new XDomainRequest,c=c+((-1===c.indexOf("?")?"?":"&")+"t="+ +new Date),e=p.ontimeout=p.onerror=function(){f.emit("finish",0,"");f._cleanup(!1)};p.onprogress=function(){f.emit("chunk",200,p.responseText)};p.onload=function(){f.emit("finish",200,p.responseText);f._cleanup(!1)};f.xdr=p;f.unload_ref=b.unload_add(function(){f._cleanup(!0)});
try{f.xdr.open(a,c),f.xdr.send(d)}catch(h){e()}};l.prototype._cleanup=function(a){if(this.xdr){b.unload_del(this.unload_ref);this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null;if(a)try{this.xdr.abort()}catch(c){}this.unload_ref=this.xdr=null}};l.prototype.close=function(){this.nuke();this._cleanup(!0)};b.isXHRCorsCapable=function(){return e.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:e.XDomainRequest&&j.domain?2:r.enabled()?3:4};var h=function(a,c,d){var f=this,
e;f._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0};d&&b.objectExtend(f._options,d);f._base_url=b.amendUrl(a);f._server=f._options.server||b.random_number_string(1E3);f._options.protocols_whitelist&&f._options.protocols_whitelist.length?e=f._options.protocols_whitelist:("string"==typeof c&&0<c.length?e=[c]:b.isArray(c)?e=c:e=null,e&&f._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.'));
f._protocols=[];f.protocol=null;f.readyState=h.CONNECTING;f._ir=N(f._base_url);f._ir.onfinish=function(a,c){f._ir=null;a?(f._options.info&&(a=b.objectExtend(a,f._options.info)),f._options.rtt&&(c=f._options.rtt),f._applyInfo(a,c,e),f._didClose()):f._didClose(1002,"Can't connect to server",!0)}};h.prototype=new k;h.version="0.3.2";h.CONNECTING=0;h.OPEN=1;h.CLOSING=2;h.CLOSED=3;h.prototype._debug=function(){this._options.debug&&b.log.apply(b,arguments)};h.prototype._dispatchOpen=function(){this.readyState===
h.CONNECTING?(this._transport_tref&&(clearTimeout(this._transport_tref),this._transport_tref=null),this.readyState=h.OPEN,this.dispatchEvent(new g("open"))):this._didClose(1006,"Server lost session")};h.prototype._dispatchMessage=function(a){this.readyState===h.OPEN&&this.dispatchEvent(new g("message",{data:a}))};h.prototype._dispatchHeartbeat=function(){this.readyState===h.OPEN&&this.dispatchEvent(new g("heartbeat",{}))};h.prototype._didClose=function(a,c,d){var f=this;if(f.readyState!==h.CONNECTING&&
f.readyState!==h.OPEN&&f.readyState!==h.CLOSING)throw Error("INVALID_STATE_ERR");f._ir&&(f._ir.nuke(),f._ir=null);f._transport&&(f._transport.doCleanup(),f._transport=null);var e=new g("close",{code:a,reason:c,wasClean:b.userSetCode(a)});if(!b.userSetCode(a)&&f.readyState===h.CONNECTING&&!d){if(f._try_next_protocol(e))return;e=new g("close",{code:2E3,reason:"All transports failed",wasClean:!1,last_event:e})}f.readyState=h.CLOSED;b.delay(function(){f.dispatchEvent(e)})};h.prototype._didMessage=function(a){switch(a.slice(0,
1)){case "o":this._dispatchOpen();break;case "a":for(var a=JSON.parse(a.slice(1)||"[]"),b=0;b<a.length;b++)this._dispatchMessage(a[b]);break;case "m":a=JSON.parse(a.slice(1)||"null");this._dispatchMessage(a);break;case "c":a=JSON.parse(a.slice(1)||"[]");this._didClose(a[0],a[1]);break;case "h":this._dispatchHeartbeat()}};h.prototype._try_next_protocol=function(a){var c=this;c.protocol&&(c._debug("Closed transport:",c.protocol,""+a),c.protocol=null);for(c._transport_tref&&(clearTimeout(c._transport_tref),
c._transport_tref=null);;){a=c.protocol=c._protocols.shift();if(!a)return!1;if(h[a]&&!0===h[a].need_body&&(!j.body||"undefined"!=typeof j.readyState&&"complete"!==j.readyState))return c._protocols.unshift(a),c.protocol="waiting-for-load",b.attachEvent("load",function(){c._try_next_protocol()}),!0;if(h[a]&&h[a].enabled(c._options)){c._transport_tref=b.delay((c._options.rto||0)*(h[a].roundTrips||1)||5E3,function(){c.readyState===h.CONNECTING&&c._didClose(2007,"Transport timeouted")});var d=b.random_string(8),
d=c._base_url+"/"+c._server+"/"+d;return c._debug("Opening transport:",a," url:"+d," RTO:"+c._options.rto),c._transport=new h[a](c,d,c._base_url),!0}c._debug("Skipping transport:",a)}};h.prototype.close=function(a,c){if(a&&!b.userSetCode(a))throw Error("INVALID_ACCESS_ERR");return this.readyState!==h.CONNECTING&&this.readyState!==h.OPEN?!1:(this.readyState=h.CLOSING,this._didClose(a||1E3,c||"Normal closure"),!0)};h.prototype.send=function(a){if(this.readyState===h.CONNECTING)throw Error("INVALID_STATE_ERR");
return this.readyState===h.OPEN&&this._transport.doSend(b.quote(""+a)),!0};h.prototype._applyInfo=function(a,c,d){this._options.info=a;this._options.rtt=c;this._options.rto=b.countRTO(c);this._options.info.null_origin=!j.domain;c=b.probeProtocols();this._protocols=b.detectProtocols(c,d,a)};l=h.websocket=function(a,c){var d=this,f=c+"/websocket";"https"===f.slice(0,5)?f="wss"+f.slice(5):f="ws"+f.slice(4);d.ri=a;d.url=f;d.ws=new (e.WebSocket||e.MozWebSocket)(d.url);d.ws.onmessage=function(a){d.ri._didMessage(a.data)};
d.unload_ref=b.unload_add(function(){d.ws.close()});d.ws.onclose=function(){d.ri._didMessage(b.closeFrame(1006,"WebSocket connection broken"))}};l.prototype.doSend=function(a){this.ws.send("["+a+"]")};l.prototype.doCleanup=function(){var a=this.ws;a&&(a.onmessage=a.onclose=null,a.close(),b.unload_del(this.unload_ref),this.unload_ref=this.ri=this.ws=null)};l.enabled=function(){return!!e.WebSocket||!!e.MozWebSocket};l.roundTrips=2;var m=function(){};m.prototype.send_constructor=function(a){this.send_buffer=
[];this.sender=a};m.prototype.doSend=function(a){this.send_buffer.push(a);this.send_stop||this.send_schedule()};m.prototype.send_schedule_wait=function(){var a=this,c;a.send_stop=function(){a.send_stop=null;clearTimeout(c)};c=b.delay(25,function(){a.send_stop=null;a.send_schedule()})};m.prototype.send_schedule=function(){var a=this;if(0<a.send_buffer.length){var b="["+a.send_buffer.join(",")+"]";a.send_stop=a.sender(a.trans_url,b,function(){a.send_stop=null;a.send_schedule_wait()});a.send_buffer=
[]}};m.prototype.send_destructor=function(){this._send_stop&&this._send_stop();this._send_stop=null};var O=function(a,c,d){if(!("_send_form"in this)){var f=this._send_form=j.createElement("form"),e=this._send_area=j.createElement("textarea");e.name="d";f.style.display="none";f.style.position="absolute";f.method="POST";f.enctype="application/x-www-form-urlencoded";f.acceptCharset="UTF-8";f.appendChild(e);j.body.appendChild(f)}var f=this._send_form,e=this._send_area,h="a"+b.random_string(8);f.target=
h;f.action=a+"/jsonp_send?i="+h;var g;try{g=j.createElement('<iframe name="'+h+'">')}catch(k){g=j.createElement("iframe"),g.name=h}g.id=h;f.appendChild(g);g.style.display="none";try{e.value=c}catch(m){b.log("Your browser is seriously broken. Go home! "+m.message)}f.submit();var l=function(){g.onerror&&(g.onreadystatechange=g.onerror=g.onload=null,b.delay(500,function(){g.parentNode.removeChild(g);g=null}),e.value="",d())};return g.onerror=g.onload=l,g.onreadystatechange=function(){"complete"==g.readyState&&
l()},l},P=function(a){return function(b,d,f){return(new a("POST",b+"/xhr_send",d)).onfinish=function(a){f(a)},function(a){f(0,a)}}},l=h["jsonp-polling"]=function(a,c){b.polluteGlobalNamespace();this.ri=a;this.trans_url=c;this.send_constructor(O);this._schedule_recv()};l.prototype=new m;l.prototype._schedule_recv=function(){var a=this,c=a.trans_url+"/jsonp",d="a"+b.random_string(6),c=c+"?c="+escape("_jp."+d),f=function(b){delete e._jp[d];a._recv_stop=null;b&&(a._is_closing||a.ri._didMessage(b));a._is_closing||
a._schedule_recv()},h,g=j.createElement("script"),k,l=function(a){k&&(k.parentNode.removeChild(k),k=null);g&&(clearTimeout(h),g.parentNode.removeChild(g),g.onreadystatechange=g.onerror=g.onload=g.onclick=null,g=null,f(a),f=null)},m=!1,n=null;g.id="a"+b.random_string(8);g.src=c;g.type="text/javascript";g.charset="UTF-8";g.onerror=function(){n||(n=setTimeout(function(){m||l(b.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1E3))};g.onload=function(){l(b.closeFrame(1006,"JSONP script loaded abnormally (onload)"))};
g.onreadystatechange=function(){if(/loaded|closed/.test(g.readyState)){if(g&&g.htmlFor&&g.onclick){m=!0;try{g.onclick()}catch(a){}}g&&l(b.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}};if("undefined"==typeof g.async&&j.attachEvent)if(/opera/i.test(navigator.userAgent))k=j.createElement("script"),k.text="try{var a = document.getElementById('"+g.id+"'); if(a)a.onerror();}catch(x){};",g.async=k.async=!1;else{try{g.htmlFor=g.id,g.event="onclick"}catch(q){}g.async=!0}"undefined"!=
typeof g.async&&(g.async=!0);h=setTimeout(function(){l(b.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35E3);c=j.getElementsByTagName("head")[0];c=(c.insertBefore(g,c.firstChild),k&&c.insertBefore(k,c.firstChild),l);e._jp[d]=c;a._recv_stop=function(){e._jp[d]&&e._jp[d](b.closeFrame(1E3,"JSONP user aborted read"))}};l.enabled=function(){return!0};l.need_body=!0;l.prototype.doCleanup=function(){this._is_closing=!0;this._recv_stop&&this._recv_stop();this.ri=this._recv_stop=null;this.send_destructor()};
l=function(){};l.prototype=new m;l.prototype.run=function(a,b,d,f,e){this.ri=a;this.trans_url=b;this.send_constructor(P(e));this.poll=new E(a,f,b+d,e)};l.prototype.doCleanup=function(){this.poll&&(this.poll.abort(),this.poll=null)};var w=h["xhr-streaming"]=function(a,c){this.run(a,c,"/xhr_streaming",y,b.XHRCorsObject)};w.prototype=new l;w.enabled=function(){return e.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)};w.roundTrips=2;w.need_body=!0;m=h["xdr-streaming"]=
function(a,c){this.run(a,c,"/xhr_streaming",y,b.XDRObject)};m.prototype=new l;m.enabled=function(){return!!e.XDomainRequest};m.roundTrips=2;var F=h["xhr-polling"]=function(a,c){this.run(a,c,"/xhr",y,b.XHRCorsObject)};F.prototype=new l;F.enabled=w.enabled;F.roundTrips=2;w=h["xdr-polling"]=function(a,c){this.run(a,c,"/xhr",y,b.XDRObject)};w.prototype=new l;w.enabled=m.enabled;w.roundTrips=2;var r=function(){};r.prototype.i_constructor=function(a,c,d){var f=this;f.ri=a;f.origin=b.getOrigin(d);f.base_url=
d;f.trans_url=c;a=d+"/iframe.html";f.ri._options.devel&&(a+="?t="+ +new Date);f.window_id=b.random_string(8);a+="#"+f.window_id;f.iframeObj=b.createIframe(a,function(a){f.ri._didClose(1006,"Unable to load an iframe ("+a+")")});f.onmessage_cb=b.bind(f.onmessage,f);b.attachMessage(f.onmessage_cb)};r.prototype.doCleanup=function(){if(this.iframeObj){b.detachMessage(this.onmessage_cb);try{this.iframeObj.iframe.contentWindow&&this.postMessage("c")}catch(a){}this.iframeObj.cleanup();this.onmessage_cb=this.iframeObj=
this.iframeObj=null}};r.prototype.onmessage=function(a){if(a.origin===this.origin){var b=a.data.slice(0,8),d=a.data.slice(8,9),a=a.data.slice(9);if(b===this.window_id)switch(d){case "s":this.iframeObj.loaded();this.postMessage("s",JSON.stringify([h.version,this.protocol,this.trans_url,this.base_url]));break;case "t":this.ri._didMessage(a)}}};r.prototype.postMessage=function(a,b){this.iframeObj.post(this.window_id+a+(b||""),this.origin)};r.prototype.doSend=function(a){this.postMessage("m",a)};r.enabled=
function(){var a=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof e.postMessage||"object"==typeof e.postMessage)&&!a};var G,H=function(a,c){parent!==e?parent.postMessage(G+a+(c||""),"*"):b.log("Can't postMessage, no parent window.",a,c)},u=function(){};u.prototype._didClose=function(a,c){H("t",b.closeFrame(a,c))};u.prototype._didMessage=function(a){H("t",a)};u.prototype._doSend=function(a){this._transport.doSend(a)};u.prototype._doCleanup=function(){this._transport.doCleanup()};
b.parent_origin=void 0;h.bootstrap_iframe=function(){var a;G=j.location.hash.slice(1);b.attachMessage(function(c){if(c.source===parent&&("undefined"==typeof b.parent_origin&&(b.parent_origin=c.origin),c.origin===b.parent_origin)){var d=c.data.slice(0,8),f=c.data.slice(8,9),c=c.data.slice(9);if(d===G)switch(f){case "s":var g=JSON.parse(c),d=g[0],f=g[1],c=g[2],g=g[3];d!==h.version&&b.log('Incompatibile SockJS! Main site uses: "'+d+'", the iframe: "'+h.version+'".');if(!b.flatUrl(c)||!b.flatUrl(g)){b.log("Only basic urls are supported in SockJS");
break}if(!b.isSameOriginUrl(c)||!b.isSameOriginUrl(g)){b.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([e.location.href,c,g])+")");break}a=new u;a._transport=new u[f](a,c,g);break;case "m":a._doSend(c);break;case "c":a&&a._doCleanup(),a=null}}});H("s")};var z=function(a,c){var d=this;b.delay(function(){d.doXhr(a,c)})};z.prototype=new n(["finish"]);z.prototype.doXhr=function(a,c){var d=this,f=(new Date).getTime(),g=new c("GET",a+"/info"),e=b.delay(8E3,function(){g.ontimeout()});
g.onfinish=function(a,b){clearTimeout(e);e=null;if(200===a){var c=(new Date).getTime()-f,g=JSON.parse(b);"object"!=typeof g&&(g={});d.emit("finish",g,c)}else d.emit("finish")};g.ontimeout=function(){g.close();d.emit("finish")}};var K=function(a){var c=this,d=function(){var b=new r;b.protocol="w-iframe-info-receiver";var d=function(a){"string"==typeof a&&"m"===a.substr(0,1)?(a=JSON.parse(a.substr(1)),c.emit("finish",a[0],a[1])):c.emit("finish");b.doCleanup();b=null};b.i_constructor({_options:{},_didClose:d,
_didMessage:d},a,a)};j.body?d():b.attachEvent("load",d)};K.prototype=new n(["finish"]);var L=function(){var a=this;b.delay(function(){a.emit("finish",{},2E3)})};L.prototype=new n(["finish"]);var N=function(a){if(b.isSameOriginUrl(a))return new z(a,b.XHRLocalObject);switch(b.isXHRCorsCapable()){case 1:return new z(a,b.XHRLocalObject);case 2:return new z(a,b.XDRObject);case 3:return new K(a);default:return new L}};(u["w-iframe-info-receiver"]=function(a,c,d){(new z(d,b.XHRLocalObject)).onfinish=function(b,
c){a._didMessage("m"+JSON.stringify([b,c]));a._didClose()}}).prototype.doCleanup=function(){};n=h["iframe-eventsource"]=function(){this.protocol="w-iframe-eventsource";this.i_constructor.apply(this,arguments)};n.prototype=new r;n.enabled=function(){return"EventSource"in e&&r.enabled()};n.need_body=!0;n.roundTrips=3;(u["w-iframe-eventsource"]=function(a,c){this.run(a,c,"/eventsource",I,b.XHRLocalObject)}).prototype=new l;n=h["iframe-xhr-polling"]=function(){this.protocol="w-iframe-xhr-polling";this.i_constructor.apply(this,
arguments)};n.prototype=new r;n.enabled=function(){return e.XMLHttpRequest&&r.enabled()};n.need_body=!0;n.roundTrips=3;(u["w-iframe-xhr-polling"]=function(a,c){this.run(a,c,"/xhr",y,b.XHRLocalObject)}).prototype=new l;n=h["iframe-htmlfile"]=function(){this.protocol="w-iframe-htmlfile";this.i_constructor.apply(this,arguments)};n.prototype=new r;n.enabled=function(){return r.enabled()};n.need_body=!0;n.roundTrips=3;(u["w-iframe-htmlfile"]=function(a,c){this.run(a,c,"/htmlfile",J,b.XHRLocalObject)}).prototype=
new l;var E=function(a,b,d,f){this.ri=a;this.Receiver=b;this.recv_url=d;this.AjaxObject=f;this._scheduleRecv()};E.prototype._scheduleRecv=function(){var a=this,b=a.poll=new a.Receiver(a.recv_url,a.AjaxObject);b.onmessage=function(b){a.ri._didMessage(b.data)};b.onclose=function(d){a.poll=b=b.onmessage=b.onclose=null;a.poll_is_closing||("permanent"===d.reason?a.ri._didClose(1006,"Polling error ("+d.reason+")"):a._scheduleRecv())}};E.prototype.abort=function(){this.poll_is_closing=!0;this.poll&&this.poll.abort()};
var I=function(a){var c=this,d=new EventSource(a);d.onmessage=function(a){c.dispatchEvent(new g("message",{data:unescape(a.data)}))};c.es_close=d.onerror=function(a,e){var h=e?"user":2!==d.readyState?"network":"permanent";c.es_close=d.onmessage=d.onerror=null;d.close();d=null;b.delay(200,function(){c.dispatchEvent(new g("close",{reason:h}))})}};I.prototype=new k;I.prototype.abort=function(){this.es_close&&this.es_close({},!0)};var A,J=function(a){var c=this;b.polluteGlobalNamespace();c.id="a"+b.random_string(6,
26);a+=(-1===a.indexOf("?")?"?":"&")+"c="+escape("_jp."+c.id);if(void 0===A)if("ActiveXObject"in e)try{A=!!new ActiveXObject("htmlfile")}catch(d){}else A=!1;var f=A?b.createHtmlfile:b.createIframe,h;e._jp[c.id]={start:function(){h.loaded()},message:function(a){c.dispatchEvent(new g("message",{data:a}))},stop:function(){c.iframe_close({},"network")}};c.iframe_close=function(a,b){h.cleanup();c.iframe_close=h=null;delete e._jp[c.id];c.dispatchEvent(new g("close",{reason:b}))};h=f(a,function(){c.iframe_close({},
"permanent")})};J.prototype=new k;J.prototype.abort=function(){this.iframe_close&&this.iframe_close({},"user")};var y=function(a,b){var d=this,f=0;d.xo=new b("POST",a,null);d.xo.onchunk=function(a,b){if(200===a)for(;;){var c=b.slice(f),e=c.indexOf("\n");if(-1===e)break;f+=e+1;c=c.slice(0,e);d.dispatchEvent(new g("message",{data:c}))}};d.xo.onfinish=function(a,b){d.xo.onchunk(a,b);d.xo=null;d.dispatchEvent(new g("close",{reason:200===a?"network":"permanent"}))}};return y.prototype=new k,y.prototype.abort=
function(){this.xo&&(this.xo.close(),this.dispatchEvent(new g("close",{reason:"user"})),this.xo=null)},h.getUtils=function(){return b},h.getIframeTransport=function(){return r},h}();"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1);"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS});function WebTCP(j,e){this.sockets={};this.httpClients={};this.sock=new SockJS("http://"+j+":"+e+"/bridge");this.ready=!1;this.outputBuffer=[];var b=this;this.sock.onopen=function(){b.ready=!0;b.processBuffer()};this.processBuffer=function(){if(0<this.outputBuffer.length&&this.ready)for(var b in this.outputBuffer)this.sock.send(this.outputBuffer[b])};this.sock.onmessage=function(e){e.data=JSON.parse(e.data);e.data.sID?(sID=e.data.sID,b.sockets[sID].onEvent(e.data.eventName,e.data.data)):e.data.cID&&
(cID=e.data.cID,b.httpClients[cID].onEvent(e.data.eventName,e.data.data))};this.sock.onclose=function(){console.log("close")};this.createSocket=function(b,e,j){return new Socket(this,b,e,j)};this.createHTTPClient=function(){return new Http(this)}};function WebTCPAPI(){this.onEvent=function(j,e){this["on"+j](e);if(this["on"+j+"Custom"])this["on"+j+"Custom"](e)};this.on=function(j,e){this["on"+j+"Custom"]=e};this.rpc=function(j,e){var b=this.createPacket();b.command=j;b.args=e;this.send(JSON.stringify(b));return b.id};this.write=function(j){var e=this.createPacket();e.data=j;this.send(JSON.stringify(e));return e.id};this.send=function(j){if(this.webtcp.ready)this.webtcp.sock.send(j);else{if(this.webtcp.outputBuffer>this.webtcp.BUFF_SIZE)throw"Output buffer is already full, but sockJS connection is not ready yet";
this.webtcp.outputBuffer.push(j)}};this.onerror=function(j){throw j;}};
